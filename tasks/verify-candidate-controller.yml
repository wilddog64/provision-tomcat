- name: Wait for candidate port from controller
  wait_for:
    host: "{{ tomcat_candidate_delegate_host }}"
    port: "{{ tomcat_candidate_delegate_port }}"
    timeout: "{{ tomcat_candidate_wait_timeout }}"
    delay: "{{ tomcat_candidate_wait_delay }}"
  delegate_to: "{{ tomcat_candidate_delegate }}"
  vars:
    ansible_connection: "{{ tomcat_candidate_delegate_connection | default('local') }}"
    ansible_python_interpreter: "{{ tomcat_candidate_delegate_python | default(omit, true) }}"
  run_once: true

- name: Verify candidate HTTP response from controller
  uri:
    url: "http://{{ tomcat_candidate_delegate_host }}:{{ tomcat_candidate_delegate_port }}"
    method: GET
    status_code: [200, 404]
    timeout: 30
  delegate_to: "{{ tomcat_candidate_delegate }}"
  vars:
    ansible_connection: "{{ tomcat_candidate_delegate_connection | default('local') }}"
    ansible_python_interpreter: "{{ tomcat_candidate_delegate_python | default(omit, true) }}"
  run_once: true
